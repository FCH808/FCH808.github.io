---
title: "Data Analysis with R"
author: "Fernando Hernandez"
date: "Monday, January 19, 2015"
output: html_document
---

```{r libraries, message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(tidyr)
library(scales)
library(gridExtra)
```

## Introduction

On May 30, 2014 MIT and Harvard released de-identified data from 13 HarvardX and MITx courses offered in 2012-13.[1]

The data contains records from 476,532 students covering 641,138 separate course registrations.[2]


## Initial Exploration

When exploring a new dataset, it's always a good idea to look at the structure with str(). This data set provides demographic and anonymized online activity data, including grades.

```{r load_data}

setwd("data")
mooc_data <- tbl_df(read.csv("HMXPC13_DI_v2_5-14-14.csv", na.strings = c("NA", "")))

dim(mooc_data)

str(mooc_data)



```

The exact meanings of the variables can looked up in the "Person Course Documentation.pdf". First, let's tidy up the data a bit by separating course_id, which contains 3 different types of information, into 3 separate columns. We can also add Age using the user-provided birth year. [2]

We will then add the full title of the courses based on the Course Codes from the "Person Course Documentation.pdf".

```{r }
levels(mooc_data$course_id)

levels(mooc_data$gender) <- c("Female", "Male", "Other")

mooc_data <- mooc_data %>%
  separate(course_id, into = c("Institution", "Course_Code", "Semester"), sep="/", convert=TRUE) %>%
  mutate(Age = 2014 - YoB,
         certified = factor(certified, labels=c("No", "Yes"))) %>%
  rename(Country = final_cc_cname_DI,
         Level_of_Edu = LoE_DI,
         Registration_Date = start_time_DI,
         Last_Interaction = last_event_DI)

## Add in full course titles from codebook.[2]
course_names <- data.frame("Course_Code" = factor(c("CB22x", "CS50x", "ER22x", "PH207x", "PH278x", "14.73x",
                                             "2.01x", "3.091x", "6.002x", "6.00x", "7.00x", "8.02x", "8.MReV")),
                           "Full_Title" = c("The Ancient Greek Hero", "Intro to Computer Science I",
                                            "Justice", "Health in Numbers: Quant. Methods", 
                                            "Human Health & Global Envir. Change",
                                            "The Challenges of Global Poverty", "Elements of Structures",
                                            "Intro to Solid State Chemistry", "Circuits and Electronics",
                                            "Intro to C.S. and Programming", "Intro to Biology",
                                            "Electricity and Magnetism", "Mechanics Review"))

mooc_data <- left_join(mooc_data, course_names, by="Course_Code")


# Add in School Colors for plots
# http://web.mit.edu/graphicidentity/colors.html
# http://www.hbs.edu/marketing/color.html

mooc_data <- mooc_data %>%
  mutate(School_Color = ifelse(Institution == "HarvardX", "#A41034", "#000000"))

school_colors <- mooc_data$School_Color
names(school_colors) <- mooc_data$Institution

```



```{r warning=FALSE, message=FALSE}
## This dataset contains data for 641,138 course registrations
table(mooc_data$registered)
## 476,532 unique students showing some students were registered for mulitple courses in this dataset.
str(levels(mooc_data$userid_DI))

## About 400,262 (62.4%) of students accessed the Courseware tab
## which contains the videos, problem sets, and exams.
## This leaves 240,876 students who never did anything in the course after registering.
prop.table(table(mooc_data$viewed))
table(mooc_data$viewed)
ggplot(mooc_data, aes(x=factor(viewed))) + geom_histogram() + scale_y_continuous(labels=comma)

## Only about 39,686 (6.2%) of students accessed at least half of the chapters for a given course.
prop.table(table(mooc_data$explored))
table(mooc_data$explored)
ggplot(mooc_data, aes(x=factor(explored))) + geom_histogram() + scale_y_continuous(labels=comma)

## Only 17,687 (2.8%) of registered students completed a given course and
## received a certificate (earned 50%-80% depending on course)
prop.table(table(mooc_data$certified))
table(mooc_data$certified)
ggplot(mooc_data, aes(x=factor(certified))) + geom_histogram() + scale_y_continuous(labels=comma)

## The US and India have the largest amounts of registered students
ggplot(mooc_data, aes(x=factor(Country))) + geom_histogram() + scale_y_continuous(labels=comma) + coord_flip()

## The most common education level of experience is a bachelors. 
prop.table(table(mooc_data$Level_of_Edu))
table(mooc_data$Level_of_Edu)
ggplot(mooc_data, aes(x=Level_of_Edu)) + geom_histogram() + scale_y_continuous(labels=comma)

## Classes all start on different dates, this information doesn't seem too useful by itself
ggplot(mooc_data, aes(x=Registration_Date)) + geom_histogram() + scale_y_continuous(labels=comma) 

# mooc_data$Registration_Date <- as.Date(as.character(mooc_data$Registration_Date), format="%Y-%m-%d")
# mooc_data$Last_Interaction <- as.Date(as.character(mooc_data$Last_Interaction), format="%Y-%m-%d")
# mooc_data$days_between <- as.numeric(mooc_data$Last_Interaction - mooc_data$Registration_Date)
# ggplot(mooc_data, aes(x=days_between, y=grade)) + geom_point(alpha=1/10)

## 199,151 (31%) students had 0 interactions beyond just registering
## 171,714 (26.8%) students had 10 or less interactions with the website beyond registration
prop.table(table(mooc_data$nevents<=10, useNA="always"))
table(mooc_data$nevents<=10, useNA="always")

ggplot(mooc_data, aes(x=nevents)) + geom_histogram() + scale_y_continuous(labels=comma)
ggplot(mooc_data, aes(x=nevents)) + geom_histogram(binwidth=50) + coord_cartesian(xlim=c(0, 1000)) + scale_y_continuous(labels=comma)

## 457,530 (71.4%) did not play any videos at all within courses.
## 11.1% played videos 10 or less times, while 17.5% played videos more than 10 times. 
## This is slightly startling because most of the instruction for courses
## are presented by the videos.
## One reason for the large proportion may be because some courses allow
## downloads of videos which are more effective for slower/intermittant 
## internet connections.
prop.table(table(mooc_data$nplay_video<=10, useNA="always"))
table(mooc_data$nplay_video<=10, useNA="always")

ggplot(mooc_data, aes(x=nplay_video)) + geom_histogram() + scale_y_continuous(labels=comma)
ggplot(mooc_data, aes(x=nplay_video)) + geom_histogram(binwidth=50) + coord_cartesian(xlim=c(0, 1000)) + scale_y_continuous(labels=comma)

## 162,743 (25.4%) did not interact with the course any days
## 422,441 (65.9%) interaction on 10 or less unique days.
## This isn't much considering courses typically run 2-3 months long.
## 55,954 (8.7%) interacted with the courses on more than 10 unique days.
## This may be a good indicator for how well a student ultimately does.
prop.table(table(mooc_data$ndays_act<=10, useNA="always"))
table(mooc_data$ndays_act<=10, useNA="always")
ggplot(mooc_data, aes(x=ndays_act)) + geom_histogram() + scale_y_continuous(labels=comma)

## 40.4% of students didn't interact with any chapters of the course.
## Number of chapters varies per course so this statistic may be difficult to interpret.
## 19% of students only interacted with 1 chapter.
prop.table(table(mooc_data$nchapters<=1, useNA="always"))
table(mooc_data$nchapters<=1, useNA="always")
ggplot(mooc_data, aes(x=nchapters)) + geom_histogram() + scale_y_continuous(labels=comma)

## Very few students make any forum posts.
## Only 7461 (1.2%) made any posts at all. 633,677 (98.8%) were either lurkers or did not
## visit the forums.
prop.table(table(mooc_data$nforum_posts==0, useNA="always"))
table(mooc_data$nforum_posts<=0, useNA="always")
ggplot(mooc_data, aes(x=nforum_posts)) + geom_histogram() + scale_y_continuous(labels=comma)

## 100161 (15.6%) showed some inconsistency between log tables of different interation variables.
## This just shows that there is a bit of noise in the data, but it looks to be pretty consistent.
prop.table(table(mooc_data$incomplete_flag, useNA="always"))
table(mooc_data$incomplete_flag, useNA="always")

## Mean age across the dataset is 28.75. Minimum of 1 and 592 people under 5 years old shows
## there may be some noise in the data. There are also 96,605 who did not enter a birth year.
## Age shows a right skew with the midsection at 26-28, consistent with the largest group
## having a Bachelor's degree.
summary(mooc_data$Age)
table(mooc_data$Age<=5)
ggplot(mooc_data, aes(x=Age)) + geom_histogram(binwidth=1) + scale_y_continuous(labels=comma)

## Computer Science courses seem to be the most popular courses.
ggplot(mooc_data, aes(x=Full_Title)) + geom_histogram() + scale_y_continuous(labels=comma) + coord_flip()

## MITx/HarvardX courses have roughly similar amounts of registered students in the dataset.
ggplot(mooc_data, aes(x=Institution)) + geom_histogram() + scale_y_continuous(labels=comma) + coord_flip()


## Flagging Active Students as a feature.
## Distributions may be very different for students who are at least somewhat
## active when compared to those who register but do little to nothing after.

ggplot(mooc_data, aes(x=grade)) + geom_freqpoly()
summary(mooc_data$grade)

mooc_data_active <- mooc_data %>%
  filter(viewed == 1 & nevents > 0)

ggplot(mooc_data_active, aes(x=grade)) + geom_freqpoly()

mooc_data_active <- mooc_data %>%
  filter(viewed == 1 & nevents > 0 & grade > 0.0)

ggplot(mooc_data_active, aes(x=grade)) + geom_freqpoly()

mooc_data_active <- mooc_data %>%
  filter(viewed == 1 & nevents > 0 & grade > 0.0 & explored == 1)

ggplot(mooc_data_active, aes(x=grade)) + geom_freqpoly()

## Active Users - those who:
## 1.) Viewed the Courseware section at least once; viewed == 1
## 2.) Had at least 1 interaction with the the course beyond registration; nevents > 0
## 3.) Explored at least 1/2 of the chapters of the course in the Courseware; explored == 1
## 4.) Had a final grade that was at least more than 0.0%; grade > 0.0
## Note: #4 has some implications for HarvardX Intro to CS I, since
## that course is pass/fail (0.0%/100.0%) with a threshold of 50% to receive passing certificate.



## Add Active_User as a feature
mooc_data <- mooc_data %>%
  mutate(Active_User = ifelse( (viewed == 1 & nevents > 0 & explored == 1 & grade > 0.0), 1, 0),
         Active_User = factor(Active_User, labels=c("Not Active", "Active")))

## There are a relatively small group who have no information for any of these features,
## but most students can be categorized as Active or No Active
## There are 26,463 active students with 613,744 who were not active.
## 931 students had no information available in all 4 criteria.
table(mooc_data$Active_User, useNA="always")

## About 4.1% of online students meet the criteria for being an active student
prop.table(table(mooc_data$Active_User))

ggplot(subset(mooc_data, !is.na(Active_User)), aes(x=Active_User)) + geom_histogram()



```

## Multivariate

```{r }

## Grades of Active Users

ggplot(subset(mooc_data, Active_User == "Active"), aes(x=grade)) + geom_freqpoly(aes(color=Institution), binwidth=0.01)
ggplot(subset(mooc_data, Active_User == "Active"), aes(x=grade)) + geom_freqpoly(aes(color=Full_Title), binwidth=0.01)
ggplot(subset(mooc_data, Active_User == "Active"), aes(x=grade)) + geom_freqpoly(aes(color=Country), binwidth=0.01)
ggplot(subset(mooc_data, Active_User == "Active"), aes(x=grade)) + geom_freqpoly(aes(color=gender), binwidth=0.01)
ggplot(subset(mooc_data, Active_User == "Active"), aes(x=grade)) + geom_freqpoly(aes(color=Level_of_Edu), binwidth=0.01)

## A small of users below 10 years old looks suspect. 
## Interesting split at 50%. 
ggplot(mooc_data, aes(x=Age, y=grade)) + geom_jitter(aes(color=Institution), alpha=1/10) + scale_y_continuous(labels=percent, breaks=seq(0, 1, 0.1)) + scale_x_continuous(breaks=seq(0, 80, 10)) + scale_color_manual(values = school_colors)

# Popularity
ggplot(mooc_data, aes(x=Full_Title)) + geom_histogram(aes(fill = Institution)) + theme(axis.text.x=element_text(angle=90, size=9)) + scale_fill_manual(values = school_colors) + coord_flip() + theme_minimal()

# Gender Enrollment
ggplot(subset(mooc_data, (!is.na(gender) & gender != "Other")), aes(x=Full_Title)) + geom_histogram(aes(fill=gender), position="dodge", color="black") + theme_minimal() + theme(axis.text.x=element_text(angle=90, size=9)) + coord_flip()


## CS50 is a pass/fail 0%/100% course
mooc_summary_any <- mooc_data %>%
  filter(!is.na(grade)) %>%
  group_by(Full_Title, Institution) %>%
  summarise(avg_grade_any = mean(grade),
            n_any = n())

mooc_summary_active <- mooc_data %>%
  filter(!is.na(grade),
         Active_User == "Active") %>%
  group_by(Full_Title, Institution) %>%
  summarise(avg_grade_active = mean(grade),
            n_active = n())

mooc_summary <- left_join(mooc_summary_any, mooc_summary_active) %>%
  mutate(active_perc = n_active/n_any)

ggplot(mooc_summary, aes(x=reorder(Full_Title, avg_grade_any), y=avg_grade_any)) + geom_bar(aes(fill=Institution), stat="identity") + theme(axis.text.x=element_text(angle=90, size=9)) + scale_fill_manual(values = school_colors) + coord_flip() + theme_minimal() + scale_y_continuous(labels=percent) + ggtitle("Among All Registered Users")

## What about among Active Users? Since Intro to CS1 is pass/fail, anyone who is active does not have 0.0 as a grade, and must have full 100% causing the average to be 100%.

ggplot(mooc_summary, aes(x=reorder(Full_Title, avg_grade_active), y=avg_grade_active)) + geom_bar(aes(fill=Institution), stat="identity") + theme(axis.text.x=element_text(angle=90, size=9)) + scale_fill_manual(values = school_colors) + coord_flip() + theme_minimal() + scale_y_continuous(labels=percent) + ggtitle("Among Active Users")

ggplot(mooc_summary, aes(x=reorder(Full_Title, active_perc), y=active_perc)) + geom_bar(aes(fill=Institution), stat="identity") + theme(axis.text.x=element_text(angle=90, size=9)) + scale_fill_manual(values = school_colors) + coord_flip() + theme_minimal() + scale_y_continuous(labels=percent) + ggtitle("% of Active Users per Course")

# Events


# Events to grades
ggplot(mooc_data, aes(x=nevents, y=grade)) + geom_jitter(alpha=1/10)

ggplot(mooc_data, aes(x=nplay_video, y=grade)) + geom_jitter(alpha=1/10)

ggplot(mooc_data, aes(x=ndays_act, y=grade)) + geom_jitter(alpha=1/10)

ggplot(mooc_data, aes(x=nchapters, y=grade)) + geom_jitter(alpha=1/10)

ggplot(mooc_data, aes(x=nforum_posts, y=grade)) + geom_jitter(alpha=1/10)

ggplot(subset(mooc_data, Age > 5), aes(x=Age, y=grade)) + geom_jitter(alpha=1/10) + scale_x_continuous(breaks = seq(5, 80, by=5)) + theme_minimal()

# ggplot(subset(mooc_data, Age > 10), aes(x=Age)) + geom_histogram(binwidth=1, color="black", fill="orange") + scale_x_continuous(breaks=seq(10, 85, 5)) + scale_y_continuous(labels=comma)

table(mooc_data$gender) # Only 17 gender marked as "Other"; leaving out for plotting



# Certified percentages
ggplot(mooc_data, aes(x=certified, y=..count../sum(..count..))) + geom_bar() + scale_y_continuous(labels=percent)


# Countries

country_grade <- mooc_data %>%
  filter(!is.na(grade)) %>%
  group_by(Country) %>%
  summarise(avg_grade = mean(grade))
# Average grade
ggplot(country_grade, aes(x=reorder(Country, avg_grade), y=avg_grade)) + geom_bar(stat="identity") + coord_flip()

# Education

# Among Active Users, there isn't much of a difference in final grades distributions
edu_grade <- mooc_data %>%
  filter(!is.na(Level_of_Edu),
         !is.na(grade),
         Active_User == "Active") %>%
  mutate(Level_of_Edu = factor(Level_of_Edu, levels = c("Less than Secondary", "Secondary", "Bachelor's", "Master's", "Doctorate"))) %>%
  group_by(Level_of_Edu) %>%
  summarise(avg_grade = mean(grade))

ggplot(edu_grade, aes(x=Level_of_Edu, y=avg_grade)) + geom_bar(stat="identity")


```

# Final Plots

```{r}
## Overall
cert <- mooc_data %>%
  filter(!is.na(certified)) %>%
  group_by(certified) %>%
  summarise(n=n()) %>%
  mutate(perc = n/sum(n))

ggplot(cert, aes(x=certified, y=perc, fill=certified)) + 
  geom_histogram(stat="identity", color="black") + 
  scale_y_continuous(labels=percent) +
  geom_text(aes(family="mono", fontface="bold", y=perc, label=paste(round(perc, 3)*100, "%", sep="")),
            color="black", size=6, vjust = -0.1)

## Popularity of courses.
mooc_pop <- mooc_data %>%
  group_by(Full_Title, Institution) %>%
  summarise(n = n())

ggplot(mooc_pop, aes(x=reorder(Full_Title, n), y=n, fill=Institution)) +
  geom_bar(stat="identity") +
  theme(axis.text.x=element_text(angle=90, size=9)) +
  scale_fill_manual(values = school_colors) + 
  coord_flip() + 
  theme_minimal() + 
  scale_y_continuous(labels=comma)


ggplot(mooc_data, aes(x=Age)) + geom_bar(binwidth=1, fill="orange", color="black") + scale_x_continuous(breaks=seq(0, 85, 5)) + scale_y_continuous(labels=comma)

age_grades <- mooc_data %>%
  filter(!is.na(grade),
         Active_User == "Active",
         Age > 5) %>%
  group_by(Age) %>%
  summarise(avg_grade = mean(grade),
            median_grade = median(grade),
            sd = sd(grade),
            lower = min(grade),
            upper = max(grade),
            quant.25 = quantile(grade, probs=0.25, na.rm=TRUE),
            quant.75 = quantile(grade, probs=0.75, na.rm=TRUE),
            n = n())

ggplot(age_grades, aes(x=Age, y=avg_grade)) + geom_point() + geom_line()


p <- ggplot(age_grades, aes(x=Age, y=avg_grade)) + 
  theme(plot.background = element_blank(),
                panel.grid.minor = element_blank(),
                panel.grid.major = element_blank(),
                panel.border = element_blank(),
                panel.background = element_blank(),
                axis.ticks = element_blank(),
                axis.title = element_blank()) +
  geom_linerange(age_grades, mapping=aes(x=Age, ymin=lower, ymax=upper), colour = "wheat2", alpha=1, size=3) + 
  geom_linerange(age_grades, mapping=aes(x=Age, ymin=quant.25, ymax=quant.75), colour = "wheat4", size=3) +
  geom_line(age_grades, mapping=aes(x=Age, y=avg_grade, group=1)) +
  geom_vline(xintercept = 12, colour = "wheat4", linetype=1, size=1, hjust=0) + 
  geom_hline(yintercept=seq(0, 1, 0.1), color="white", linetype=1) 

dottedAges <- seq(15, 75, 10) 

p <- p + geom_vline(xintercept = dottedAges, color="wheat4", linetype=3, size=0.5)

p + coord_cartesian(ylim = c(0,1.02)) +
  scale_y_continuous(labels=percent) +
  scale_x_continuous(breaks=seq(12, 82, 5), expand=c(0,0) ) +
  ggtitle("Grades") +
  theme(plot.title=element_text(face="bold",hjust=0,vjust=.8,color="#3C3C3C",size=20)) + 
  annotate("text", x=14, y=1, label="by Age", size=4, fontface="bold") + 
  annotate("text", x=25, y=.25,   label="Data represents average grades at each age from ages", size=3, color="gray30") + 
    annotate("text", x=25, y=.23, label="12 to 79. Lighter outer bands show the min/max grade ", size=3, color="gray30") +
    annotate("text", x=25, y=.21, label="for each age, and darker inner bands show the IQR.  ", size=3, color="gray30") +
  geom_point()


## Most students who register have a bachelor's
edu <- mooc_data %>%
  filter(!is.na(Level_of_Edu)) %>%
  group_by(Level_of_Edu) %>%
  summarise(n=n()) %>%
  mutate(Level_of_Edu = factor(Level_of_Edu, levels = c("Less than Secondary", "Secondary", "Bachelor's", "Master's", "Doctorate")),
         perc = n/sum(n))

e1 <- ggplot(edu, aes(x=Level_of_Edu, y=perc)) + 
  geom_bar(stat="identity", fill="#A31F34") +
  scale_y_continuous(labels=percent, limits=c(0, 0.50)) + 
  geom_text(aes(family="mono", fontface="bold", y=perc, label=paste(round(perc, 3)*100, "%", sep="")),
            color="black", size=5, vjust = -0.1)  +
  ggtitle("Any Registered Student") + 
  theme_minimal()

edu2 <- mooc_data %>%
  filter(!is.na(Level_of_Edu),
         Active_User == "Active") %>%
  group_by(Level_of_Edu) %>%
  summarise(n=n()) %>%
  mutate(Level_of_Edu = factor(Level_of_Edu, levels = c("Less than Secondary", "Secondary", "Bachelor's", "Master's", "Doctorate")),
         perc = n/sum(n))

e2 <- ggplot(edu2, aes(x=Level_of_Edu, y=perc)) +
  geom_bar(stat="identity", fill="#A31F34") +
  scale_y_continuous(labels=percent, limits=c(0, 0.50)) + 
  geom_text(aes(family="mono", fontface="bold", y=perc, label=paste(round(perc, 3)*100, "%", sep="")),
            color="black", size=5, vjust = -0.1) + 
  ggtitle("Active Users") + 
  theme_minimal()

## When looking at Active Users, higher education 
grid.arrange(e1, e2)

########Active Users #############

# ggplot(mooc_summary, aes(x=reorder(Full_Title, avg_grade), y=avg_grade)) + geom_bar(aes(fill=Institution), stat="identity") + theme(axis.text.x=element_text(angle=90, size=9)) + scale_fill_manual(values = school_colors) + coord_flip() + theme_minimal() + scale_y_continuous(labels=percent) 


mooc_gender_active <- mooc_data %>%
  filter(!is.na(gender),
         gender != "Other",
         Active_User == "Active") %>%
  group_by(gender) %>%
  summarise(avg_grade = mean(grade, na.rm=TRUE),
            n=n())

# Grades among active users by gender
ggplot(mooc_gender_active, aes(x=gender)) + geom_bar(aes(fill=gender, y=avg_grade), stat="identity") +
  coord_flip() + 
  scale_y_continuous(labels=percent) +
  geom_text(aes(family="mono", fontface="bold", y=avg_grade, label=paste(round(avg_grade, 3)*100, "%", sep="")),
            color="white", size=10, hjust=1)

######## Gender ################

## Gender differences in completing courses
mooc_gender <- mooc_data %>%
  filter(!is.na(gender),
         gender != "Other") %>%
  group_by(certified, gender) %>%
  summarise(n=n()) %>%
  group_by(gender) %>%
  mutate(percentage = n/sum(n))

ggplot(mooc_gender, aes(x=certified, y=percentage, fill=certified)) + geom_bar(stat="identity", color="black") +
  scale_y_continuous(labels=percent) + facet_wrap(~gender) + 
  geom_text(aes(family="mono", fontface="bold", y=percentage, label=paste(round(percentage, 3)*100, "%", sep="")),
            color="black", size=6, vjust = -0.1) +
  theme_minimal()

# Gender Enrollment

ggplot(subset(mooc_data, (!is.na(gender) & gender != "Other")), aes(x=gender, fill=gender) ) +
  geom_bar(color="black") +
  theme_minimal() +
  scale_y_continuous(labels=comma)

gender_enroll <- mooc_data %>%
  filter(!is.na(gender), 
         gender != "Other") %>%
  group_by(Full_Title, gender, Institution) %>%
  summarise(n = n()) 

ggplot(gender_enroll, aes(x=reorder(Full_Title, n), y=n, fill=gender) ) +
  geom_bar(stat="identity", position="dodge", color="black") +
  theme_minimal() +
  coord_flip() + 
  scale_y_continuous(labels=comma) 

############## Country #############

country_grade <- mooc_data %>%
  filter(!is.na(grade),
         Active_User == "Active") %>%
  group_by(Country) %>%
  summarise(avg_grade = mean(grade))

ggplot(country_grade, aes(x=reorder(Country, avg_grade), y=avg_grade)) + geom_bar(stat="identity", fill="#A31F34") + coord_flip() + scale_y_continuous(labels = percent) + 
  geom_text(aes(family="mono", fontface="bold", y=avg_grade, label=paste(round(avg_grade, 3)*100, "%", sep="")),
            color="white", size=3, hjust=1.5) + 
  theme_minimal() + 
  ggtitle("Active Users")

country_cert <- mooc_data %>%
  group_by(Country, certified) %>%
  summarise(n = n()) %>%
  group_by(Country) %>%
  mutate(perc = n/sum(n))

ggplot(subset(country_cert, certified=="Yes"), aes(x=reorder(Country, perc), y=perc)) + geom_bar(stat="identity", fill="#A31F34") + coord_flip() + scale_y_continuous(labels = percent) + 
  geom_text(aes(family="mono", fontface="bold", y=perc, label=paste(round(perc, 3)*100, "%", sep="")),
            color="white", size=3, hjust=1.5) + 
  theme_minimal()

country_age <- mooc_data %>%
  filter(!is.na(Age)) %>%
  group_by(Country) %>%
  summarise(avg_age = mean(Age)) 

ggplot(country_age, aes(x=reorder(Country, avg_age), y=avg_age)) + geom_bar(stat="identity", fill="#A31F34") + coord_flip() + geom_text(aes(family="mono", fontface="bold", y=avg_age, label=round(avg_age, 2)),
            color="white", size=3, hjust=1.5) 

```


```{r}
# http://web.mit.edu/graphicidentity/colors.html
MIT_hex <- "#A31F34"
MIT_accent <- "#8A8B8C"

# http://www.hbs.edu/marketing/color.html
Harvard_hex <- "#A41034"
Harvard_accent <- "#faae53"

```

[1] http://newsoffice.mit.edu/2014/mit-and-harvard-release-de-identified-learning-data-open-online-courses

[2] http://thedata.harvard.edu/dvn/dv/mxhx
