<!DOCTYPE html>
<meta charset="utf-8">
<meta http-equiv="refresh" content="300000">
<html>
<style>
	/* Beautiful CSS styling here for now. */
	/*
	path {
		stroke: white;
		stroke-width: 0.25px;
		fill: grey;
	}*/
	.chart-bar {
	  fill: steelblue;
	}

	.chart-update {
	  fill: green;
	}

	.chart-bar:hover {
	  fill: brown;
	}

	.chart-exit {
		fill:red;
	}

	.chart-text {

	  fill: white;
	  font: 9px sans-serif;
	  text-anchor: middle;
	}

	.linepath {
		stroke: black;
		stroke-opacity: 0;
	}

	.myTooltip {                                                       /* NEW */
	background: #eee; 
    border: 2px solid #a1a1a1;	
	border-radius: 25px;                                              /* NEW */
	box-shadow: 0 0 5px #999999;                                    /* NEW */
	color: #333;                                                    /* NEW */
	display: none;                                                  /* NEW */
	font-size: 12px;                                                /* NEW */
	left: 130px;                                                    /* NEW */
	padding: 8px;                                                  /* NEW */
	position: absolute;                                             /* NEW */
	text-align: center;                                             /* NEW */
	top: 95px;                                                      /* NEW */
    z-index: 10;                                                    /* NEW */
	} 

	.circle {
		fill-opacity: 0.4;
		stroke: black;
		stroke-opacity: .8;
	}

	.world {
		fill: gray;
		stroke-width: 0.25px;
		stroke: gray;
	}

	.sphere, .graticule {
	  stroke: gray; 
	  stroke-width: 0.1px;
	}

	path {
	  fill: none;
	  stroke-linejoin: round;
	}

	.overlay {
	  fill: none;
	  pointer-events: all;
	}


</style> 
<body>



<!-- <script src="http://d3js.org/d3.geo.projection.v0.min.js"></script> -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<!--<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css"> -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<link href="./css/flag-icon.css" rel="stylesheet">
<link href="./assets/docs.css" rel="stylesheet">

<div class="container-fluid">
<div class="row">
  <div class="col-xs-4 col-sm-4 col-md-4">
	  <h3>Year </h3>
  </div>

</div>
<div class="row">
	<div class="col-xs-12 col-sm-6 col-md-6">
		<div class="col-xs-3 col-md-3">
		  <div class="btn-group-vertical"> 
			<button type="button" class="btn btn-warning btn-xs" id="play_btn">Pause <span class="glyphicon glyphicon-pause"></span></button>
			<button type="button" class="btn btn-success btn-xs" id="paths_btn" disabled="disabled">Paths On</button>
			<button type="button" class="btn btn-success btn-xs" id="circles_btn" disabled="disabled">Circles On</button>
		  </div>
		</div>
		<div class="col-xs-3 col-md-3">
		  <div class="btn-group-vertical btn-group-xs">
			<button type="button" class="btn btn-success" id="phyics_btn">Phyics On<span class="flag-icon flag-icon-gr"></span></button>
			<button type="button" class="btn btn-success" id="chemistry_btn">Chemistry On</button>
			<button type="button" class="btn btn-success" id="physiology_btn">Physiology On</button>
		  </div>
		</div>
		<div class="col-xs-3 col-md-3">
		  <div class="btn-group-vertical btn-group-xs">
			<button type="button" class="btn btn-success" id="economics_btn">Economics On</button>
			<button type="button" class="btn btn-success" id="peace_btn">Peace On</button>
			<button type="button" class="btn btn-success" id="literature_btn">Literature On</button>
		  </div>
		</div>  
	</div>
	<div class="col-sm-4 col-md-6">
	  <div class="col-xs-12 col-sm-6 col-md-4">

<div id="histViz">
	<svg class="chart"></svg>
</div>

	  </div> 
	</div>
</div>
</div>

		<form id="animation_slider">
		  <label for="animation_speed" style="text-align: center; font-size: 9px">
		         <span id="animation_speed-value">1.5</span> Seconds Between Years
		  </label>
		  <input type="range" min="0.0" max="3" step="0.1" id="animation_speed">
		</form>



<div id="mapViz"></div>




	<script>
		/*Java java */
////////////////////////////////////////////////////////////////////////////
// World Map Pre-Loads
////////////////////////////////////////////////////////////////////////////
	var width = 960,
		height = 500,		//http://bl.ocks.org/patricksurry/6621971
	    rotate = -10,
	    fields_set = d3.set(['physics', 'chemistry', 'physiology','economics', 'peace', 'literature']);


	var projection = d3.geo.mercator()
		.rotate([rotate,0])
		.translate([width/2, height/2])
		.center([15, 20])
		.scale(180)

	var currentZoom = 1, // Global variable for zoom level when creating circles. Needed for dynamic zoom.
		circleSize = 5; // Size of circles

	var color = d3.scale.category10();

	var path = d3.geo.path()
		.projection(projection);

	var zoom = d3.behavior.zoom()
		.scaleExtent([.9, 30]) // Controls the amount of allowable magnification.
		.on("zoom", zoomed);

	var mainSVG = d3.select("#mapViz") // Select the "mapViz" div defined earlier in <body>
		.append("svg")
		.attr("width", width)
		.attr("height", height)
		.style("background-color", "#A5DEFF")
		.call(zoom) //Color the water in the main svg

	// Create an overlay for hanging controls on in-map
	mainSVG.append("rect")
	    .attr("class", "overlay")
	    .attr("width", width)
	    .attr("height", height)

	var graticule = d3.geo.graticule();  //Graticule is a geographic grid.

	var zoomCanvas = mainSVG.append("g").attr("class", "mainSVG")

	var worldGroup = zoomCanvas.append("g").attr("class", "allWorld");

	var peopleGroup = zoomCanvas.append("g").attr("class", "allPeople");

	worldGroup.append("path")
		.datum(graticule)
		.attr("class", "graticule")
		.attr("d", path)

	// Simplest possible buttons
	var slider = d3.select(".overlay").append("p")
		.append("input")
		.attr({"type":"range", "min":0.0, "max":3, "step":0.1})

////////////////////////////////////////////////////////////////////////////
// Tooltip //
/////////////
// http://zeroviscosity.com/d3-js-step-by-step/step-5-adding-tooltips   ////
        var myTooltip = d3.select('#mapViz')                              // 
          .append('div')                                                  // 
          .attr('class', 'myTooltip');                                    // 

        myTooltip.append('div')                                           // 
          .attr('class', 'name');                                         // 
             
        myTooltip.append('div')                                           // 
          .attr('class', 'count');                                        // 

        myTooltip.append('div')                                           // 
          .attr('class', 'percent');                                      // 

        myTooltip.append('div')                                           // 
          .attr('class', 'field');                                        // 

        myTooltip.append('div')                                           // 
          .attr('class', 'institution');                                  // 

        myTooltip.append('div')                                           // 
          .attr('class', 'born');                                         // 

        myTooltip.append('div')                                           // 
          .attr('class', 'city');                                         // 
////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////
// Histogram Pre-Loads Begin
////////////////////////////////////////////////////////////////////////////
	histWidth = height/2
	histHeight = width/8

	var x = d3.scale.ordinal()
	    .rangeRoundBands([0, histWidth], .1);

	var y = d3.scale.linear()
	    .range([histHeight, 0]);
 	// var barWidth = width / data.length;

	var chart = d3.select(".chart")	
		.attr("width", histWidth)
		.attr("height", histHeight)
////////////////////////////////////////////////////////////////////////////
// Histogram Pre-Loads End
////////////////////////////////////////////////////////////////////////////

	d3.json("data/world-110m.json", function(error, world) {

		worldGroup.append("path")
			.datum(topojson.feature(world, world.objects.countries))
			.attr("class", "boundary")
			.attr("d", path)
			.style("fill", "#CDC")
			.style("stroke-width", 0.3)
			.style("stroke", "gray")


		d3.csv("data/nobel_locations.csv", function(error, nobel) {

			function jitter(min, max) {
			    return Math.random() * (max - min) + min;
			}

			years = d3.set() // Set of years for iterating through.

			nobel.forEach( function(d){
				// Convert year to interger
  				d.year_won = +d.year_won
  				// Translate lon/lat into x/y once for using later.
  				// Jitter the coordinates slightly to avoid some overplotting.
  				d.birth_x = projection([d.born_lon, d.born_lat])[0] * jitter(.9999, 1)
  				d.birth_y = projection([d.born_lon, d.born_lat])[1] * jitter(.9999, 1)
  				d.acquired_x = projection([d.award_lon, d.award_lat])[0] * jitter(.99, 1)
  				d.acquired_y = projection([d.award_lon, d.award_lat])[1] * jitter(.99, 1)
  				// Grab years for our years set while we're here.
  				years.add(+d.year_won)
			})

			years = years.values() // Get the values in the set.


			function update(year) {

	            d3.select("h3")
	              .text("Year: " + year);


				function makeArc1(d) {
					var dx = d.birth_x,
						dy = d.birth_y,
						dr = Math.sqrt(dx*dx + dy*dy);
					return "M" + d.birth_x + "," + d.birth_y + "A" + dr + "," + dr + " 0 0,1 " + d.birth_x + "," + d.birth_y;
				}

				function makeArc2(d) {
					var dx = d.acquired_x - d.birth_x,
						dy = d.acquired_y - d.birth_y,
						dr = Math.sqrt(dx*dx + dy*dy);
					return "M" + d.birth_x + "," + d.birth_y + "A" + dr + "," + dr + " 0 0,1 " + d.acquired_x + "," + d.acquired_y;
				}

				// Key function needed for filtered data, otherwise new data is bound by index
				// Index only is problematic when filtering by multiple fields (year & field)
				// http://bost.ocks.org/mike/constancy/
				// Add year to unique entry key since 4 people won multiple nobel prizes and newer
				// awards overwrote old. All prizes should be shown now.
				function key(d) { 
				  return d.name + " " + d.year_won; 
				}

				var filtered = nobel.filter( function (d) 
					{ return d.year_won <= year && fields_set.has(d.nobel_field_short); })

				var arcs = peopleGroup.selectAll("path")
									.data(filtered, key)

				var circlesTemp = peopleGroup.selectAll("circle")
									.data(filtered, key)
																			


				arcs.exit().remove();
				circlesTemp.exit().remove();

				var v0 = arcs.enter()
					.append("path")
					.attr("class", "arc linepath nobel_winner")
					.attr("id", key)
					.attr("d", makeArc1)
					// transition line from birth city to city/country when awarded.
					.transition()
					.delay(500)
					.duration(1500)
					.style("stroke-opacity", lineOpacity)
					.attr("d", makeArc2)


				
				var c0 = circlesTemp.enter()
						.append("circle")
						.on("mouseover", mouseover)
						.on("mouseout", mouseout)
						.on("mousedown", animateFirst)
							//.attr("id", fieldID) // Assign ID to each field for show/hide buttons
							.attr("class", "circle nobel_winner")							
							.attr("r", 0)
							.attr("fill", "grey")
							.attr("transform", function(d) {
								return "translate(" + d.birth_x + "," + d.birth_y + ")"; })
							.style("fill-opacity", 0.4)
							.style("visibility", circleVis) // Create hidden/vis circles depending on toggle
							//.style("stroke-opacity", circleStrokeOpacity)
							.transition()
							.duration(250)
							.attr("r", circleSize/currentZoom)
							.ease("bounce")
							.transition()
							.duration(250)
							.ease("bounce")
							.attr("r", (circleSize/2) /currentZoom)
							.transition()
							.duration(1500)
							.ease("cubic-in-out") //default;
							.attr("transform", function(d) {
								return "translate(" + d.acquired_x + "," + d.acquired_y + ")"; })
							.attr("r", circleSize/currentZoom)
							.style("fill", function(d) { return color(d.nobel_field);});

///////////////////////////////////////////////////////////////////////////////////////////
// Histogram Begin
///////////////////////////////////////////////////////////////////////////////////////////
				function agg_cntry(leaves) {
					// leaves here is an array of filtered data from d3.nest().key()
					// in this case, it's each subset of cities, for each year
					// We can get the number of entries with length on the subset
					// which contains one data object for each row
					var totalNobels = leaves.length;

					return {'totalNobels': totalNobels,
							// Each short name is the same for each country group.
							// Grab the first short name for small charts.
							'countryShortName': leaves[0].award_ctry_short_name }; 
				};

				function compareValues(a,b){ 
				    return b.values['totalNobels'] - a.values['totalNobels']; }

				var nested = d3.nest()
								.key( function(d) {
									return d.award_country; })
								.rollup(agg_cntry)
								.sortKeys(d3.ascending)
								.sortValues(compareValues)	
								.entries(filtered)

				
				// Sort the entries and save to nested. Did not work in the first d.nest() call?
				var nested = d3.nest()
								.sortValues(compareValues)
								.entries(nested)
				//slice out the top N entries only.
				var nested = nested.slice(0, 6)

				x.domain(nested.map(function(d) { return d.key; }));
				y.domain([0, d3.max(nested, function(d) { return d.values['totalNobels']; })]);

				function nestedKey(d) { 
				  return d.values['countryShortName'] + " " + d.values['totalNobels']; 
				}

				//debugger;
				//chart.selectAll('g').remove();
				//debugger;

				var bar = chart.selectAll("g")
					  .data(nested, nestedKey)
				// Update existing bars, move them to their new places, adjust height, etc.
				updateBar = bar.transition()
      							.duration(750)
      							.attr("transform", function(d) { return "translate(" + x(d.key) + ",0)"; });
				// Update existing bars' rect dimensions/position, text, data-driven fields.
				updateBar.select("rect")
					.attr("class", "chart-update") //green
					.attr("y", function(d) {return y(d.values['totalNobels']); })
					.attr("height", function(d) {return histHeight - y(d.values['totalNobels']); })
					.attr("width", x.rangeBand());

				updateBar.select("text")
					.attr("x", x.rangeBand() / 2)
					.attr("y", function(d) {return y(d.values['totalNobels']) + 2; })
					.attr("dy", ".75em")
					.text(function(d) {return d.values['countryShortName'] + " " + d.values['totalNobels']; });
				// Enter in new bars, and adjust their data-driven properties
				newBar = bar.enter().append("g")

				newBar.attr("transform", function(d) { return "translate(" + x(d.key) +
							 "," + x(d.key) +")"; })
					.transition()
						.duration(250)
						.ease("elastic")
						.attr("transform", function(d) { return "translate(" + x(d.key) + ",0)"; });

				newBar.append("rect")
					.attr("class", "chart-bar")			//blue
					.attr("y", function(d) {return y(d.values['totalNobels']); })
					.attr("height", function(d) {return histHeight - y(d.values['totalNobels']); })
					.attr("width", x.rangeBand())
					
					//.attr("class", "flag flag-icon-background flag-icon-gr");

				newBar.append("text")

					.attr("class", "chart-text")
					.attr("x", x.rangeBand() / 2)
					.attr("y", function(d) {return y(d.values['totalNobels']) + 2; })
					.attr("dy", ".75em")
					.text(function(d) {return d.values['countryShortName'] + " " + d.values['totalNobels']; });
				// Remove outdated bars that should no longer be shown.
				bar.exit()
					.attr("class", "chart-exit")
				  .transition()
				  	.duration(750)
				  	.attr("x", 0)
				  	.style("fill-opacity", 1e-6)
					.remove();

///////////////////////////////////////////////////////////////////////////////////////////
// Histogram End				
///////////////////////////////////////////////////////////////////////////////////////////
			};


			var year_idx = 0;

			// Class object for a timer to add to years_idx.
			// http://stackoverflow.com/questions/7279567/how-do-i-pause-a-window-setinterval-in-javascript/7282347#7282347
			function goYears(goYearsCallback, delay) {
				var timerID, start, remaining = delay;

				// Pause the timer
				this.pause = function() {
					window.clearTimeout(timerID);
					remaining -= new Date() - start;
				};

				//Reset the timer
				//this.reset = function() {
				//	window.clearTimeout(timerID);
				//	remaining = new Date();
				//}

				var resume = function(newSpeed) {
					start = new Date();
					timerID = window.setTimeout(function() {
						remaining = delay;
						resume(newSpeed);
						goYearsCallback();
					}, newSpeed) 
				};

				this.resume = resume;
				this.resume(newSpeed);
				};

			function goYearsCallback() {
			// If timer is being resumed after all years have already been cycled through...
				if(year_idx === 0) {
					// ... remove all circle and arc classes first to restart animation.
					d3.selectAll(".nobel_winner").remove();
				}
				window.year = +years[year_idx]
				
				update(year);

				year_idx++

				if(year_idx >= years.length) {
					timer.pause();
					// If all years have been cycled through, reset the year index back to 0
					year_idx = 0
					// Show that button can now be used to reset the animation
					self = d3.select("#play_btn")
					self.text("Reset ")
						.attr('class', 'btn btn-danger btn-xs')
					// Change this button's glyphs and text in the span
					self.append("span")
						.attr("class", "glyphicon glyphicon-fast-backward")

					// Add short delays for show buttons to allow animation to finish draws.
					d3.select('#paths_btn').transition().delay(1500).attr("disabled", null);
					d3.select('#circles_btn').transition().delay(1500).attr("disabled", null);
				};
			}

			var timer = new goYears(goYearsCallback, newSpeed); // Transition time in millisec between switching years.
			
			

			// Interactions / Clickables:

			//Change CSS styling on button if pause/play/reset available.
			d3.select('#play_btn').on('click',function(d,i){
				var self = d3.select(this);

				if (self.text() === "Pause "){		
					timer.pause()
					// Change the class to success to change color

					self.text("Play ").attr('class', 'btn btn-success btn-xs')
					// Change this button's glyphs and text in the span
					self.append("span").attr("class", "glyphicon glyphicon-play")

					// Add short delays for show buttons to allow animation to finish draws.
					d3.select('#paths_btn').transition().delay(1500).attr("disabled", null);
					d3.select('#circles_btn').transition().delay(1500).attr("disabled", null);

				}else{
					timer.resume(newSpeed)
					// Change the class to success to change color
					self.text("Pause ").attr('class', 'btn btn-warning btn-xs')
					// Change this button's glyphs and text in the span
					self.append("span").attr("class", "glyphicon glyphicon-pause")

					d3.select('#paths_btn').attr("disabled", "disabled");
					d3.select('#circles_btn').attr("disabled", "disabled");

					
				}
			});

			// Give the option to hide paths. Only allow button when paused to avoid half/drawn paths.
			d3.select('#paths_btn').on('click', function(d,i) {
				var self = d3.select(this);
				if(self.text() === "Paths Off"){
					self.text('Paths On').attr('class', 'btn btn-success btn-xs');
					d3.selectAll('.arc').transition().delay(1500).duration(500)
						.style("visibility", "visible")
				}else{
					self.text("Paths Off").attr('class', 'btn btn-danger btn-xs');
					d3.selectAll('.arc')
						.transition().delay(250).duration(500)
						.style("visibility", "hidden")}
			});
			// Give the option to hide paths. Only allow button when paused to avoid half/drawn paths.
			d3.select('#circles_btn').on('click', function(d,i) {
				var self = d3.select(this);
				if(self.text() === "Circles Off"){
					self.text('Circles On').attr('class', 'btn btn-success btn-xs');
					d3.selectAll('.circle').transition().delay(1500).duration(500)
						.style("visibility", "visible")
				}else{
					self.text("Circles Off").attr('class', 'btn btn-danger btn-xs');
					d3.selectAll('.circle')
						.transition().delay(250).duration(500)
						.style("visibility", "hidden")}
			});

			// Chemistry show/hide TODO: eliminate redundancy.
			d3.select("#chemistry_btn").on("click", function(d, i) {
				var self = d3.select(this);
				if(self.text() === "Chemistry Off"){
					self.text("Chemistry On").attr('class', 'btn btn-success btn-xs');
					fields_set.add('chemistry')
					update(year)
						//.style("stroke-opacity", circleStrokeOpacity)
				}else{
					self.text("Chemistry Off").attr('class', 'btn btn-danger btn-xs');
					fields_set.remove('chemistry')
					update(year)}
			});

			// Physics show/hide TODO: eliminate redundancy.
			d3.select("#phyics_btn").on("click", function(d, i) {
				var self = d3.select(this);
				if(self.text() === "Phyics Off"){
					self.text("Phyics On").attr('class', 'btn btn-success btn-xs');
					fields_set.add('physics')
					update(year)
						//.style("stroke-opacity", circleStrokeOpacity)
				}else{
					self.text("Phyics Off").attr('class', 'btn btn-danger btn-xs');
					fields_set.remove('physics')
					update(year)}
			});

			// Physics show/hide TODO: eliminate redundancy.
			d3.select("#physiology_btn").on("click", function(d, i) {
				var self = d3.select(this);
				if(self.text() === "Physiology Off"){
					self.text("Physiology On").attr('class', 'btn btn-success btn-xs');
					fields_set.add('physiology')
					update(year)
						//.style("stroke-opacity", circleStrokeOpacity)
				}else{
					self.text("Physiology Off").attr('class', 'btn btn-danger btn-xs');
					fields_set.remove('physiology')
					update(year)}
			});
			// Economics show/hide TODO: eliminate redundancy.
			d3.select("#economics_btn").on("click", function(d, i) {
				var self = d3.select(this);
				if(self.text() === "Economics Off"){
					self.text("Economics On").attr('class', 'btn btn-success btn-xs');
					fields_set.add('economics')
					update(year)
						//.style("stroke-opacity", circleStrokeOpacity)
				}else{
					self.text("Economics Off").attr('class', 'btn btn-danger btn-xs');
					fields_set.remove('economics')
					update(year)}
			});
			// Physics show/hide TODO: eliminate redundancy.
			d3.select("#peace_btn").on("click", function(d, i) {
				var self = d3.select(this);
				if(self.text() === "Peace Off"){
					self.text("Peace On").attr('class', 'btn btn-success btn-xs');
					fields_set.add('peace')
					update(year)
						//.style("stroke-opacity", circleStrokeOpacity)
				}else{
					self.text("Peace Off").attr('class', 'btn btn-danger btn-xs');
					fields_set.remove('peace')
					update(year)}
			});
						// Physics show/hide TODO: eliminate redundancy.
			d3.select("#literature_btn").on("click", function(d, i) {
				var self = d3.select(this);
				if(self.text() === "Literature Off"){
					self.text("Literature On").attr('class', 'btn btn-success btn-xs');
					fields_set.add('literature')
					update(year)
						//.style("stroke-opacity", circleStrokeOpacity)
				}else{
					self.text("Literature Off").attr('class', 'btn btn-danger btn-xs');
					fields_set.remove('literature')
					update(year)}
			});




		});

	});	

	// Global interactions.

	//Initial animation speed from timer in html.
	newSpeed = 1000 * d3.select('#animation_speed').property("valueAsNumber")

	d3.select("#animation_speed").on("input", function() {
	  updateSpeed(+this.value);
	 // or d3.select("#animation_speed").node().valueAsNumber; 
	  window.newSpeed = 1000 * d3.select('#animation_speed').property("valueAsNumber")
	  console.log(newSpeed)
	});
	
	//Initial animation speed.
	//updateSpeed(newSpeed);
	
	// update the elements
	function updateSpeed(newSpeed) {
	  // adjust the text on the range slider
	  d3.select("#animation_speed-value").text(newSpeed);
	  d3.select("#animation_speed").property("value", newSpeed);
	 }

	

	//Functions:


	// Make sure lines are created with 0 opacity if lines button is toggled off.
	function lineOpacity() {
		if (d3.select('#paths_btn').text() ==='Paths Off'){return 0
		}else{return 0.15}
	};

	function circleVis() {
		if (d3.select('#circles_btn').text() ==='Circles Off'){return "hidden"
		}else{return "visible"}
	};

	//Function to move selection to top of renedering queue.
	// http://stackoverflow.com/questions/14167863/how-can-i-bring-a-circle-to-the-front-with-d3
	d3.selection.prototype.moveToFront = function() { 
	  return this.each(function() { 
	    this.parentNode.appendChild(this); 
	  }); 
	}; 

	//Function to move selection to back of renedering queue.
	d3.selection.prototype.moveToBack = function() { 
	    return this.each(function() { 
	        var firstChild = this.parentNode.firstChild; 
	        if (firstChild) { 
	            this.parentNode.insertBefore(this, firstChild); 
	        } 
	    }); 
	};

	// Give mouseover tooltips, and clickable animations.
	function mouseover(d) {

		// Display the tooltip at the x,y coord on the #mapViz html area
		myTooltip.style("top", (d3.event.pageY + 10) + "px")
			   .style("left", (d3.event.pageX + 10) + "px");
		myTooltip.select(".name").html(d.name);
		myTooltip.select(".field").html("Field: " + d.nobel_field + ", " + d.year_won);
		myTooltip.select(".institution").html("Inst.: " + d.institution);
		myTooltip.select(".city").html("Location: " + d.award_city )
		myTooltip.select(".born").html("Born: " + d.born_city)
		myTooltip.style("display", "block");

		// When mousing over, make solid and larger
		d3.select(this)
		//	.transition()
		//	.duration(400)
			.style("fill-opacity", 0.6)
			.attr("r", 3*circleSize/currentZoom)
			//.attr("stroke-width", 4*currentZoom)

			//.style("fill", "red");
		//d3.select('.nobel_winner').attr('color', "red")
		// Move moused over circle to be rendered above all other circles.
		// 
		// d3.select(this).moveToFront();
		}

	function mouseout(d) {
		// Make the circle attributes return to defaults and
		// tooltip disappear when moused off of.
		d3.select(this)
		//	.transition()
		//	.duration(200)
			.style("fill-opacity", 0.4)
			.attr("r", circleSize/currentZoom)

		myTooltip.style("display", "none")
		}

	// Make an animation when a circle is clicked.
	// http://christopheviau.com/d3_tutorial/
	// Make larger..
	function animateFirst() {
		d3.select(this)
		.transition()
		  .delay(0)
		  .duration(100)
		  .attr("r", (circleSize*4) /currentZoom)
		  .each("end", animateSecond)
		};
	// Then return to normal size.
	function animateSecond() {
		d3.select(this)
		  .transition()
		    .duration(200)
		    .attr("r", circleSize/currentZoom)
		    // Add for loop
		    //.each("end", animateFirst)
		};


	function zoomed() {

		//d3.event.sourceEvent.preventDefault();
		// d3.event.translate is equivalent since this d3.event is the zoom() parent zoom() function.
		// d3.event syntax used for clarity. Not sure which would be more efficient.
		//console.log(zoom.translate  ())
		window.currentZoom = d3.event.scale;
		// Scaled zooming
		// https://groups.google.com/forum/#!topic/d3-js/z9kqLRj7Puo

		zoomCanvas.attr("transform", "translate(" + 
				d3.event.translate.join(",") + ")scale(" + d3.event.scale + ")" )
			.style("stroke-width", 1/d3.event.scale)  // Scale lines as you zoom.
			.selectAll("circle").attr("r", circleSize/d3.event.scale); 
													  
		
		//g.selectAll("path")
		//	.attr("d", path.projection(projection));
	}

	</script>

</body>
</html>


<!--
			var force = d3.layout.force()
				.nodes(cities)
				.size([width, height])
				.on("tick", tick)
				.charge(300)
				.gravity(0.1)

			force.start()

			node = worldGroup.selectAll("circle")
				.data(force.nodes())
				.enter()
				.append("circle")
				.style("fill", "steelblue")
				.attr("r", 10)

			function tick() {
				
				node.each(messWithPosition());

				node.attr("cx", function(d) { return d.birth_x; })
					.attr("cy", function(d) { return d.birth_y})
			}

			function messWithPosition(){
				return function(d) {
					d.birth_x += 0
					d.birth_y += 0
				}
			}
*/ -->